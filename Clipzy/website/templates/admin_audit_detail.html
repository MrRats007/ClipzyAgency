{# templates/admin_audit_detail.html #}
{% extends "base.html" %}
{% block title %}Audit #{{ audit.id }}{% endblock %}

{% block extra_head %}
<style>
  .topbar{
    padding: 24px 0 14px;
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap: 12px;
    flex-wrap: wrap;
  }
  .topbar h1{
    margin: 0;
    font-size: 22px;
    letter-spacing: -0.02em;
  }
  .topbar p{
    margin: 6px 0 0;
    color: var(--muted);
    font-size: 14px;
  }
  .top-actions{
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items:center;
  }

  .detail-grid{
    display:grid;
    grid-template-columns: 1.05fr .95fr;
    gap: 14px;
    margin-top: 8px;
  }

  .card{
    border-radius: calc(var(--radius) + 6px);
    border: 1px solid var(--border);
    background: rgba(255,255,255,.02);
    box-shadow: var(--shadow);
    overflow: hidden;
  }
  .card-head{
    padding: 14px 14px;
    border-bottom: 1px solid rgba(255,255,255,.08);
    background: rgba(255,255,255,.015);
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .card-head strong{
    font-size: 14px;
    letter-spacing: -0.01em;
  }

  .body{
    padding: 14px;
  }

  .kv{
    display:grid;
    grid-template-columns: 140px 1fr;
    gap: 10px 14px;
    align-items:start;
  }
  .k{
    color: rgba(167,179,204,.92);
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: .08em;
    font-weight: 850;
  }
  .v{
    color: rgba(234,240,255,.92);
    font-size: 14px;
    word-break: break-word;
  }
  .v a{ text-decoration: underline; }

  .pill{
    display:inline-flex;
    align-items:center;
    gap: 8px;
    padding: 7px 10px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.02);
    color: var(--muted);
    font-weight: 800;
    font-size: 12px;
    white-space: nowrap;
  }
  .dot{ width:8px; height:8px; border-radius:50%; background: rgba(255,255,255,.25); }
  .pill[data-s="New"] .dot{ background: rgba(109,94,252,.9); box-shadow: 0 0 0 4px rgba(109,94,252,.18); }
  .pill[data-s="Contacted"] .dot{ background: rgba(43,231,165,.9); box-shadow: 0 0 0 4px rgba(43,231,165,.14); }
  .pill[data-s="Qualified"] .dot{ background: rgba(255,193,7,.9); box-shadow: 0 0 0 4px rgba(255,193,7,.14); }
  .pill[data-s="Closed"] .dot{ background: rgba(255,90,90,.9); box-shadow: 0 0 0 4px rgba(255,90,90,.14); }

  .field{
    display:flex;
    flex-direction:column;
    gap: 7px;
    margin-bottom: 12px;
  }
  label{
    color: rgba(167,179,204,.9);
    font-size: 13px;
    font-weight: 650;
  }
  select, textarea{
    width: 100%;
    padding: 12px 12px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.02);
    color: var(--text);
    outline: none;
    transition: border-color .15s ease, background .15s ease;
  }
  textarea{ min-height: 160px; resize: vertical; }
  select:focus, textarea:focus{
    border-color: rgba(109,94,252,.65);
    background: rgba(255,255,255,.03);
  }
  .actions{
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content:flex-end;
    margin-top: 6px;
  }

  .note{
    color: rgba(167,179,204,.85);
    font-size: 13px;
    margin-top: 10px;
    line-height: 1.5;
  }

  @media (max-width: 980px){
    .detail-grid{ grid-template-columns: 1fr; }
    .kv{ grid-template-columns: 120px 1fr; }
  }
</style>
{% endblock %}

{% block content %}
<div class="topbar">
  <div>
    <h1>Audit Request #{{ audit.id }}</h1>
    <p>Review the lead details and update status + internal notes.</p>
  </div>
  <div class="top-actions">
    <a class="btn btn-ghost" href="{{ url_for('auth.audits') }}">← Back to Audits</a>
    <a class="btn btn-primary" href="{{ url_for('auth.logout') }}">Logout</a>
  </div>
</div>

<div class="detail-grid">
  <!-- Lead Details -->
  <div class="card">
    <div class="card-head">
      <strong>Lead Details</strong>
      <span class="pill" data-s="{{ audit.status or 'New' }}"><span class="dot" aria-hidden="true"></span>{{ audit.status or "New" }}</span>
    </div>

    <div class="body">
      <div class="kv">
        <div class="k">Name</div>
        <div class="v">{{ audit.name }}</div>

        <div class="k">Email</div>
        <div class="v"><a href="mailto:{{ audit.email }}">{{ audit.email }}</a></div>

        <div class="k">Phone</div>
        <div class="v">{{ audit.phone or "—" }}</div>

        <div class="k">Brand</div>
        <div class="v">{{ audit.brand or "—" }}</div>

        <div class="k">Handle</div>
        <div class="v">{{ audit.ig_handle or "—" }}</div>

        <div class="k">Website</div>
        <div class="v">
          {% if audit.website %}
            <a href="{{ audit.website }}" target="_blank" rel="noopener">{{ audit.website }}</a>
          {% else %}
            —
          {% endif %}
        </div>

        <div class="k">Service</div>
        <div class="v">{{ audit.services or "—" }}</div>

        <div class="k">Budget</div>
        <div class="v">{{ audit.budget or "—" }}</div>

        <div class="k">Submitted</div>
        <div class="v">
          {% if audit.created_at %}{{ audit.created_at.strftime("%b %d, %Y • %I:%M %p") }}{% else %}—{% endif %}
        </div>

        <div class="k">Goals</div>
        <div class="v">{{ audit.goals or "—" }}</div>
      </div>

      <div class="note">
        Quick actions: copy email/handle, then reply with next steps and set status to <strong>Contacted</strong>.
      </div>
    </div>
  </div>

  <!-- Admin Notes + Status -->
  <div class="card">
    <div class="card-head">
      <strong>Admin Workflow</strong>
      <span class="pill" data-s="{{ audit.status or 'New' }}"><span class="dot" aria-hidden="true"></span>{{ audit.status or "New" }}</span>
    </div>

    <div class="body">
      <form method="POST" action="{{ url_for('auth.audit_detail', audit_id=audit.id) }}">
        <div class="field">
          <label for="status">Status</label>
          <select id="status" name="status">
            <option value="New" {% if (audit.status or "New") == "New" %}selected{% endif %}>New</option>
            <option value="Contacted" {% if audit.status == "Contacted" %}selected{% endif %}>Contacted</option>
            <option value="Qualified" {% if audit.status == "Qualified" %}selected{% endif %}>Qualified</option>
            <option value="Closed" {% if audit.status == "Closed" %}selected{% endif %}>Closed</option>
          </select>
        </div>

        <div class="field">
          <label for="admin_notes">Internal Notes</label>
          <textarea id="admin_notes" name="admin_notes" placeholder="Add notes: what they want, pricing, next steps, follow-up date...">{{ audit.admin_notes or "" }}</textarea>
        </div>

        <div class="actions">
          <a class="btn btn-ghost" href="{{ url_for('auth.audits') }}">Cancel</a>
          <button class="btn btn-primary" type="submit">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}